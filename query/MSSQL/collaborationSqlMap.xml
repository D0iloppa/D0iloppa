<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="collaborationSqlMap">
	<!-- 기안함 페이지 -->
	<select id="getCollaboList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select'DRN' as dox_kind, p.prj_id, p.drn_id, p.drn_no, p.drn_title, p.drn_prj_id, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   from p_prj_drn_info p
	   	where 1=1
	   	<!--  
	   	and p.prj_id = #{prj_id}
	   	 -->
	   	and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
	   order by p.reg_date desc, drn_id
	
<!-- 		SELECT * -->
<!-- 		FROM p_prj_drn_info -->
<!-- 		WHERE prj_id = #{prj_id} -->
<!-- 		<if test="status!=''"> -->
<!-- 			AND drn_approval_status IN  -->
<!-- 			 <foreach collection="statusList" item="status" separator=","  open="(" close=")"> #{status} </foreach>  -->
<!-- 		</if> -->
			 
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
		
<!-- 		ORDER BY reg_date desc, drn_id -->
	</select>
	
	<select id="selectCollaboList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select'DRN' as dox_kind, p.prj_id, p.drn_id, p.drn_no, p.drn_title, p.drn_prj_id, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   from p_prj_drn_info p
	   	where 1=1
	   	<!--  
	   	and p.prj_id = #{prj_id}
	   	 -->
	   	and substring(p.reg_date,1,8) between #{old_day} and  #{to_day}
	   order by p.reg_date desc, drn_id
	</select>
	
	<!-- 작성중 페이지 -->
	<select id="getCollaboWriteList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where 1=1 
		<!--  and p.prj_id = #{prj_id} -->
		and p.drn_approval_status = 'T'
		and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, drn_id
	
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date -->
<!-- 		from p_prj_drn_info p -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status = 'T' -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, drn_id -->
	</select>
	
	<select id="selectCollaboWriteList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.status = 'T'
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, drn_id
	</select>
	
	<!-- 작성중 상세페이지 -->
	<select id="getCollaboWrite" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.status = 'T'
		and p.drn_id = #{drn_id}
		order by p.reg_date desc, drn_id
	</select>
	
	<!-- 미결 페이지 --> 
	<select id="getCollaboPendingList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select main.prj_id, main.drn_id, main.drn_title, main.drn_prj_id, main.drn_no, main.status, main.doc_title, main.approval_id, main.check_sheet_id
		       ,main.check_sheet_title, main.review_conclusion, main.drn_approval_status
			   ,main.folder_id, main.reg_id, main.reg_date, main.mod_id, main.mod_date
			   ,main.reviewed_id, main.approved_id, main.dcc_yn 
		from 
		(	
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id, m.dcc_yn
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
			(select prj_id, dcc_yn from p_prj_member m where m.user_id = #{reg_id}) m
			where 1=1
			<!-- and p.prj_id = #{prj_id} -->
			<!-- DCC -->
	        and p.drn_approval_status = 'A'
		    and p.prj_id = m.prj_id 
	        and m.dcc_yn = 'Y'  				
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>
			union all
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id, 'N'
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
			where 1=1
			<!-- and p.prj_id = #{prj_id} -->
			<!-- 1차 -->
	        and p.drn_approval_status = 'E'
<!-- 	        and p.prj_id = m.prj_id  -->
	        and a.reviewed_id = #{reg_id}			
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>
			union all
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id, 'N'
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
			where 1=1
			<!-- and p.prj_id = #{prj_id} -->
			<!-- 2차 -->
	        and p.drn_approval_status = '1'
	        and a.approved_id = #{reg_id}	
<!-- 	        and p.prj_id = m.prj_id		 -->
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>						
		)as main
		group by  main.prj_id, main.drn_id, main.drn_title, main.drn_prj_id, main.drn_no, main.status, main.doc_title, main.approval_id, main.check_sheet_id
		       ,main.check_sheet_title, main.review_conclusion, main.drn_approval_status
			   ,main.folder_id, main.reg_id, main.reg_date, main.mod_id, main.mod_date
			   ,main.reviewed_id, main.approved_id, main.dcc_yn 	
		 order by main.reg_date desc, main.drn_id
	</select>		 
		 	
	<select id="getCollaboPendingList_old" resultType="CollaborationVO" parameterType="CollaborationVO">
		select main.prj_id, main.drn_id, main.drn_title, main.drn_prj_id, main.drn_no, main.status, main.doc_title, main.approval_id, main.check_sheet_id
		       ,main.check_sheet_title, main.review_conclusion, main.drn_approval_status
			   ,main.folder_id, main.reg_id, main.reg_date, main.mod_id, main.mod_date
			   ,main.reviewed_id, main.approved_id, main.dcc_yn 
		from 
		(	
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id, m.dcc_yn
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
			(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m
			where p.prj_id = #{prj_id}
			<!-- DCC -->
	        and p.drn_approval_status = 'A'
	        and m.dcc_yn = 'Y'  				
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>
			union all
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id, m.dcc_yn
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
			(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m
			where p.prj_id = #{prj_id}
			<!-- 1차 -->
	        and p.drn_approval_status = 'E'
	        and a.reviewed_id = #{reg_id}			
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>
			union all
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id, m.dcc_yn
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
			(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m
			where p.prj_id = #{prj_id}
			<!-- 2차 -->
	        and p.drn_approval_status = '1'
	        and a.approved_id = #{reg_id}			
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>						
		)as main	
		 order by main.reg_date desc, main.drn_id
	</select>			
	<!-- 
	<select id="getCollaboPendingList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id, m.dcc_yn
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
		(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m
		where p.prj_id = #{prj_id}
		and p.drn_approval_status IN('A','E','P','1','2')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id} or m.dcc_yn = 'Y' or
			#{reg_id} IN (SELECT value FROM string_split(distribute_id,'@')) -->
<!-- 			<foreach collection="distributeList" item="distribute" separator=","  open="(" close=")"> #{distribute} </foreach> -->
<!-- 		)
		<if test="from != '' ">
			AND substring(reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id -->
		
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date -->
<!-- 	   ,a.reviewed_id, a.approved_id, m.dcc_yn -->
<!-- 		from p_prj_drn_info p -->
<!-- 		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id, -->
<!-- 		(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status IN('A','E','P') -->
<!-- 		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id} or m.dcc_yn = 'Y') -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, p.drn_id 
	</select> -->
	
	<select id="selectCollaboPendingList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id, m.dcc_yn
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
		(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m
		where p.prj_id = #{prj_id}
		and p.status IN('A','E','P')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id} or m.dcc_yn = 'Y')
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 미결 상세페이지 -->
	<select id="getCollaboPending" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id, m.dcc_yn
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id,
		(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m
		where p.prj_id = #{prj_id}
		and p.status IN('A','E','P')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id} or m.dcc_yn = 'Y')
		and p.drn_id = #{drn_id}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 예고 페이지 -->
	<select id="getCollaboPrevList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select main.prj_id, main.drn_id, main.drn_title, main.drn_prj_id, main.drn_no, main.status, main.doc_title, main.approval_id, main.check_sheet_id
		       ,main.check_sheet_title, main.review_conclusion, main.drn_approval_status
			   ,main.folder_id, main.reg_id, main.reg_date, main.mod_id, main.mod_date
			   ,main.reviewed_id, main.approved_id 
		from 
		(			
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
			where 1=1 
			<!-- and p.prj_id = #{prj_id}  -->
			<!--  DCC 검토 -->
			and p.drn_approval_status = 'A' 
			and a.reviewed_id = #{reg_id}
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>
			union all
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
			where 1=1 
			<!-- and p.prj_id = #{prj_id}  -->
			<!--  1차 결재 -->
			and p.drn_approval_status = 'E' 
			and a.approved_id = #{reg_id}
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>		
		)as main		
		order by main.reg_date desc, main.drn_id	
	</select>
		
	<select id="getCollaboPrevList_old" resultType="CollaborationVO" parameterType="CollaborationVO">
		select main.prj_id, main.drn_id, main.drn_title, main.drn_prj_id, main.drn_no, main.status, main.doc_title, main.approval_id, main.check_sheet_id
		       ,main.check_sheet_title, main.review_conclusion, main.drn_approval_status
			   ,main.folder_id, main.reg_id, main.reg_date, main.mod_id, main.mod_date
			   ,main.reviewed_id, main.approved_id 
		from 
		(			
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
			where p.prj_id = #{prj_id}
			<!--  DCC 검토 -->
			and p.drn_approval_status = 'A' 
			and a.reviewed_id = #{reg_id}
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>
			union all
			select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		   ,a.reviewed_id, a.approved_id
			from p_prj_drn_info p
			left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
			where p.prj_id = #{prj_id}
			<!--  1차 결재 -->
			and p.drn_approval_status = 'E' 
			and a.approved_id = #{reg_id}
			<if test="from != '' ">
				AND substring(p.reg_date,1,8) between #{from} AND #{to}
			</if>		
		)as main		
		order by main.reg_date desc, main.drn_id	
	<!-- 
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
		where p.prj_id = #{prj_id}
		and p.drn_approval_status IN('A')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id})
		<if test="from != '' ">
			AND substring(reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
		
 -->		
		
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date -->
<!-- 	   ,a.reviewed_id, a.approved_id -->
<!-- 		from p_prj_drn_info p -->
<!-- 		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status IN('A') -->
<!-- 		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id}) -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, p.drn_id -->
	</select>
	
	<select id="selectCollaboPrevList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
		where p.prj_id = #{prj_id}
		and p.status IN('A')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id})
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 예고함 상세페이지 -->
	<select id="getCollaboPrev" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
		where p.prj_id = #{prj_id}
		and p.status IN('A')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id})
		and p.drn_id = #{drn_id}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 진행 페이지 -->
	<select id="getCollaboProgList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where 1=1 
		<!--  and p.prj_id = #{prj_id}  -->
		and p.drn_approval_status IN('E','1')
		and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
	</select>		
			
	<select id="getCollaboProgList_old" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.drn_approval_status IN('E','1')
		and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
		
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date -->
<!-- 		from p_prj_drn_info p -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status IN('E','P') -->
<!-- 		and p.reg_id = #{reg_id} -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, p.drn_id -->
	</select>
	
	<select id="selectCollaboProgList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.status IN('E','P')
		and p.reg_id = #{reg_id}
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 반려 페이지 -->
	<select id="getCollaboRejectList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where 1=1 
		<!--  and p.prj_id = #{prj_id} -->
		and p.drn_approval_status = 'R'
		and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
	</select>		
			
	<select id="getCollaboRejectList_old" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.drn_approval_status = 'R'
		and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
		
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date -->
<!-- 		from p_prj_drn_info p -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status IN('R') -->
<!-- 		and p.reg_id = #{reg_id} -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, p.drn_id -->
	</select>
	
	<select id="selectCollaboRejectList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.status IN('R')
		and p.reg_id = #{reg_id}
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 완료 페이지 -->
	<select id="getCollaboCompList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
		left outer join p_prj_member m on p.prj_id= m.prj_id and  m.user_id = #{reg_id}
		where 1=1
		<!--and	p.prj_id = #{prj_id} -->
		and p.drn_approval_status IN('C')
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id} or p.reg_id = #{reg_id} or m.dcc_yn = 'Y')		
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
		
	</select>
	<select id="getCollaboCompList_old" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.drn_approval_status IN('C')
		and p.reg_id = #{reg_id}
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
		
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date -->
<!-- 		from p_prj_drn_info p -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status IN('C') -->
<!-- 		and p.reg_id = #{reg_id} -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, p.drn_id -->
	</select>
	
	<select id="selectCollaboCompList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.status IN('C')
		and p.reg_id = #{reg_id}
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id
	</select>
	
	<!-- 전체현황 페이지 -->
	<select id="getCollaboWholeList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
	       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
		   ,p.folder_id
		   , p.reg_id ,(select CONCAT(user_kor_nm,' ',pci.code_nm ) from p_users pu left outer join p_code_info pci on pu.job_tit_cd  = pci.code and pci.code_gubun = 'JOB' where pu.user_id = p.reg_id) as design
		   ,p.reg_date, p.mod_id
		   ,(select CONCAT(user_kor_nm,' ',pci.code_nm ) from p_users pu left outer join p_code_info pci on pu.job_tit_cd  = pci.code and pci.code_gubun = 'JOB' where pu.user_id = p.mod_id) as modifier 
		   ,p.mod_date
		   ,a.reviewed_id,(select CONCAT(user_kor_nm,' ',pci.code_nm ) from p_users pu left outer join p_code_info pci on pu.job_tit_cd  = pci.code and pci.code_gubun = 'JOB' where pu.user_id = a.reviewed_id) as review , 
		   a.approved_id , (select CONCAT(user_kor_nm,' ',pci.code_nm ) from p_users pu left outer join p_code_info pci on pu.job_tit_cd  = pci.code and pci.code_gubun = 'JOB' where pu.user_id = a.approved_id) as approve
		   ,(select STUFF((select ',' + (CONCAT(pu2.user_kor_nm , ' ', pci2.code_nm))
			from p_prj_member ppm2 left outer join p_users pu2 on ppm2.user_id = pu2.user_id left outer join p_code_info pci2 on pu2.offi_res_cd = pci2.code and pci2.code_gubun ='JOB'
			where dcc_yn = 'Y' and prj_id=p.prj_id FOR XML PATH('')) ,1,1,'') ) as dcc
	   from p_prj_drn_info p left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id		
		where 1=1 
	<!-- 		and p.prj_id = #{prj_id} -->
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
	</select>
	
	<select id="getCollaboWholeList_old" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
	   ,a.reviewed_id, a.approved_id
	  <choose>
	 	 <when test='admin_yn == "N" '>
	 	 , m.dcc_yn   
	   	 </when>
	 	 <otherwise>
	 	 , 'Y' as dcc_yn   	  	  	
	  	 </otherwise>    
	  </choose>		   	   
		from p_prj_drn_info p
		left outer join p_prj_drn_approval_line a on p.prj_id  = a.prj_id and p.approval_id = a.approval_id
	  <choose>
	 	 <when test='admin_yn == "Y" '>    
	   	 </when>
	 	 <otherwise>
		,(select dcc_yn from p_prj_member m where m.prj_id = #{prj_id} and m.user_id = #{reg_id}) m	  	  	
	  	 </otherwise>    
	  </choose>			
		where p.prj_id = #{prj_id}
	  <choose>
	 	 <when test='admin_yn == "Y" '>    
	   	 </when>
	 	 <otherwise>
		and (a.reviewed_id = #{reg_id} or a.approved_id = #{reg_id} or m.dcc_yn = 'Y' or p.reg_id = #{reg_id} or
			#{reg_id} IN (SELECT value FROM string_split(distribute_id,'@')) 
     		)	  	  	
	  	 </otherwise>    
	  </choose>				
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
	</select>
	
	<select id="selectCollaboWholeList" resultType="CollaborationVO" parameterType="CollaborationVO">
	<!-- 
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id
		-->
		
	</select>	
	
	<!-- 지연현황 페이지 -->
	<select id="getCollaboDelayedList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date, p.approval_date
		from p_prj_drn_info p
		where 1=1 
		<!-- and p.prj_id = #{prj_id} -->
		and p.drn_approval_status IN('A','E','1')
		and p.reg_id = #{reg_id}
		<!-- 결재 상신A로 부터 3일 이내에 결제완료 C가 되지 않은 건 -->
		and DATEADD(DAY, 3,CONVERT (DATETIME,  SUBSTRING(p.approval_date,1,8))) &lt; GETDATE()
		<if test="from != '' ">
			AND substring(p.reg_date,1,8) between #{from} AND #{to}
		</if>
		order by p.reg_date desc, p.drn_id
		
<!-- 		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.status, p.doc_title, p.approval_id, p.check_sheet_id -->
<!--        ,p.check_sheet_title, p.check_sheet_id, p.check_sheet_title, p.review_conclusion, p.drn_approval_status -->
<!-- 	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date, p.approval_date -->
<!-- 		from p_prj_drn_info p -->
<!-- 		where p.prj_id = #{prj_id} -->
<!-- 		and p.status IN('A','E','P') -->
<!-- 		and DATEADD(DAY, 3,CONVERT (DATETIME,  SUBSTRING(p.approval_date,1,8))) &lt; GETDATE() -->
<!-- 		<if test="from != '' "> -->
<!-- 			AND substring(reg_date,1,8) between #{from} AND #{to} -->
<!-- 		</if> -->
<!-- 		order by p.reg_date desc, p.drn_id -->
	</select>
	
	<select id="selectCollaboDelayedList" resultType="CollaborationVO" parameterType="CollaborationVO">
		select p.prj_id, p.drn_id, p.drn_title, p.drn_prj_id, p.drn_no, p.status, p.doc_title, p.approval_id, p.check_sheet_id
       ,p.check_sheet_title, p.review_conclusion, p.drn_approval_status
	   ,p.folder_id, p.reg_id, p.reg_date, p.mod_id, p.mod_date, p.approval_date
		from p_prj_drn_info p
		where p.prj_id = #{prj_id}
		and p.status IN('A','E','P')
		and DATEADD(DAY, 3,CONVERT (DATETIME,  SUBSTRING(p.approval_date,1,8))) &lt; GETDATE()
		and substring(p.reg_date,1,8) between  #{old_day} and  #{to_day}
		order by p.reg_date desc, p.drn_id		
	</select>
	
	
	<select id="getAllPrjList" resultType="PrjInfoVO">
		SELECT *
		FROM p_prj_info ppi 
		where prj_hidden_yn != 'Y'
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>