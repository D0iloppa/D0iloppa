<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="organizationSqlMap">
	<select id="getOrganizationList" resultType="OrganizationVO">
		select * from p_organization
    </select>
	<select id="getOrganizationListOnlyHyundae" resultType="OrganizationVO">
		select * from p_organization where org_type='H'
    </select>
	<select id="getOrganizationListCorA" resultType="OrganizationVO">
		select * from p_organization where org_type='C' or org_type='A'
    </select>
	<select id="getLastOrgId" resultType="OrganizationVO" parameterType="OrganizationVO">
		select isnull(max(org_id),'1') as org_id
     	from p_organization
    </select>
	<select id="getParentOrgPath" resultType="OrganizationVO" parameterType="OrganizationVO">
     	select org_path
     	from p_organization
     	where org_id=#{org_parent_id}
    </select>
	<insert id="insertOrganizationVO" parameterType="OrganizationVO">
     	insert into p_organization(org_id,org_parent_id,org_nm,org_type,org_path,reg_id,reg_date)
     	values((select isnull(max(org_id)+1,'1') from p_organization),#{org_parent_id},#{org_nm},#{org_type},#{org_path},#{reg_id},#{reg_date})
    </insert>
	<update id="updateOrgNm" parameterType="OrganizationVO">
     	update p_organization
     	set org_nm=#{new_org_nm}
     	where org_id=#{org_id} and org_nm=#{org_nm}
    </update>
	<delete id="deleteOrg" parameterType="OrganizationVO">
     	delete from p_organization where org_id=#{org_id}
    </delete>
	<update id="updateOrgParentIdByJstreeDND" parameterType="OrganizationVO">
     	update p_organization
     	set org_parent_id=#{org_parent_id}, org_path=#{org_path}
     	where org_id=#{org_id} and org_parent_id=#{old_org_parent_id}
    </update>
	<update id="updateOrgPathByJstreeDND" parameterType="OrganizationVO">
     	update p_organization
     	set org_path = REPLACE(org_path,#{origin_org_path},#{org_path})
     	where org_parent_id=#{org_parent_id}
    </update>
	<update id="updateGrandsonOrgPathByJstreeDND" parameterType="OrganizationVO">
     	update p_organization
     	set org_path = REPLACE(org_path,#{origin_org_path},#{org_path})
     	where org_path like concat(#{origin_org_path},'>%')
    </update>
	<select id="getOrgGrpNmPath" resultType="OrganizationVO" parameterType="OrganizationVO">
		select dbo.fn_getGrpNm(org_id) as org_group_nm_path, charindex('>',org_path), org_id, org_nm, org_path
		from p_organization where org_id=#{org_id}
    </select>
	<select id="getDownOrg" resultType="OrganizationVO" parameterType="OrganizationVO">
		select distinct a.org_id
		from p_organization a left join p_organization_user b on a.org_id=b.org_id
		where a.org_id=#{org_id} or a.org_path like concat(#{org_id},'>%') or a.org_path like concat('%>',#{org_id},'>%')
    </select>
	<select id="getIsUseRootOrg" resultType="int" parameterType="OrganizationVO">
		select count(*) from p_organization where org_path like concat(#{org_id},'>%')
    </select>
</mapper>