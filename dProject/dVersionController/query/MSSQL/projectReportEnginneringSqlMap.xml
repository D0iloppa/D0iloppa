<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="prjReportEnginneringSqlMap">
	<select id="PrjReportEngineeringData_1" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discipline,'_') as discipline,
			isnull(doc_no,'-') as doc_no,
			isnull(rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(tr_issuepur,'-') as tr_issuepur,
			'Plan@,@Forecast@,@Actual' as type,
			STRING_AGG(case when isnull(step, '') = '' then '-' else step end, '@,@') WITHIN GROUP(ORDER BY set_order) as step,
			STRING_AGG(case when isnull(step_per, '') = '' then '-' else step_per end, '@,@') as step_per,
			STRING_AGG(case when isnull(plan_date, '') = '' then '-' else plan_date end, '@,@') as plan_date,
			STRING_AGG(case when isnull(fore_date, '') = '' then '-' else fore_date end, '@,@') as fore_date,
			STRING_AGG(case when isnull(actual_date, '') = '' then '-' else actual_date end, '@,@') as actual_date,
			isnull(wbs_code,'-') as wbs_code,
			isnull(doc_type,'-') as doc_type,
			isnull(doc_size,'-') as doc_size,
			isnull(deginer,'-') as deginer,
			isnull(tr_no,'-') as tr_no,
			send_date,
			case when remark = '' then '-' else remark end as remark
		from (
			select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			and del_yn!='Y'
			group by prj_id, doc_id)a1
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id	
			and a.doc_type='DCI'
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
			<if test='discipline!=null &amp;&amp; !discipline.equals("0")'>
				and discip_code_id = #{discipline}
			</if>       
		) aa  
		group by  discip_code_id,doc_id,discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,doc_size,deginer,tr_no,send_date,remark
		order by discipline asc,doc_no asc,plan_date asc
	</select>
	
	<select id="PrjReportEngineeringData_2" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discipline,'_') as discipline,
			isnull(doc_no,'-') as doc_no,
			isnull(aa.rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(doc_type,'-') as doc_type,
			isnull(category,'-') as category,
			isnull(doc_size,'-') as doc_size,
			isnull(wbs_code,'-') as wbs_code,
			isnull(deginer,'-') as deginer,
			STRING_AGG(case when isnull(step, '') = '' then '-' else step end, '@,@') WITHIN GROUP(ORDER BY set_order) as step,
			STRING_AGG(case when isnull(step_per, '') = '' then '-' else step_per end, '@,@') as step_per,
			STRING_AGG(case when isnull(plan_date, '') = '' then '-' else plan_date end, '@,@') as plan_date,
			STRING_AGG(case when isnull(fore_date, '') = '' then '-' else fore_date end, '@,@') as fore_date,
			STRING_AGG(case when isnull(actual_date, '') = '' then '-' else actual_date end, '@,@') as actual_date,
			isnull(remark,'-') as remark,
			isnull(tr_no,'-') as tr_no,
			isnull(issued_rev_no,'-') as issued_rev_no,
			isnull(issued_send_date,'-') as issued_send_date,
			isnull(rtn_status_code_id,'-') as rtn_status_code_id,
			isnull(rtn_status_code,'-') as rtn_status_code,
			del_yn
		from (			
			select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
			     , sub1.del_yn
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			<if test='del_yn!=null &amp;&amp; del_yn.equals("")'>
				and del_yn!='Y'
			</if>
			group by prj_id, doc_id)a1
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id		
			and a.doc_type='DCI'
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
			<if test='discipline!=null &amp;&amp; !discipline.equals("0")'>
				and discip_code_id = #{discipline}
			</if>
		) aa
		group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,del_yn
		order by discipline asc,doc_no asc,plan_date asc
	</select>
	
	<select id="PrjReportEngineeringData_3" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select 
			(select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=i.prj_id and ppdi.discip_code_id=i.discip_code_id) discipline,
			ppdi.doc_no,ppdi.title,s.prj_id,s.doc_id,s.rev_id,ppti.tr_id,ppti.tr_no,ppti.send_date,
			case when (s.rtn_status='' or s.rtn_status is null) then send_date
			else '-'
			end issue_tr_date,
			case when (s.rtn_status='' or s.rtn_status is null) then tr_no
			else '-'
			end issue_tr_no,
			case when (s.rtn_status!='' and s.rtn_status is not null) then send_date
			else '-'
			end return_tr_date,
			case when (s.rtn_status!='' and s.rtn_status is not null) then tr_no
			else '-'
			end return_tr_no,
			ppdi.rev_code_id,
			s.step_code_id,
			(select set_order from p_prj_code_settings ppcs where ppcs.prj_id=ppdi.prj_id and ppcs.set_code_type='ENGINEERING STEP' and set_code_id=s.step_code_id) as step_order,
			(select set_code from p_prj_code_settings ppcs where ppcs.prj_id=ppdi.prj_id and ppcs.set_code_type='ENGINEERING STEP' and set_code_id=s.step_code_id) as step,
			(select ppcs.set_code from p_prj_code_settings ppcs where ppcs.prj_id=ppdi.prj_id and ppcs.set_code_type='REVISION NUMBER' and ppcs.set_code_id=ppdi.rev_code_id) as rev_no
		from p_prj_eng_step s 
		left outer join p_prj_tr_info ppti on s.prj_id=ppti.prj_id and s.tr_id=ppti.tr_id
		join p_prj_eng_info i on s.prj_id=i.prj_id and s.doc_id=i.doc_id and s.rev_id=i.rev_id
		join p_prj_document_index ppdi on s.prj_id=ppdi.prj_id and s.doc_id=ppdi.doc_id and s.rev_id=ppdi.rev_id
		where s.prj_id=#{prj_id}	
			and ppdi.doc_type='DCI'
			and ppdi.del_yn!='Y'
		<if test='discipline!=null &amp;&amp; !discipline.equals("0")'>
			and i.discip_code_id = #{discipline}
		</if>
		order by discipline,doc_id,send_date
	</select>
	
	<select id="PrjReportEngineeringData_4" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discipline,'_') as discipline,
			isnull(doc_no,'-') as doc_no,
			isnull(aa.rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(category,'-') as category,
			isnull(plan_date,'-') as plan_date,
			isnull(actual_date,'-') as actual_date,
			isnull(fore_date,'-') as fore_date,
			isnull(foredate,'-') as foredate,
			DATEDIFF(DD, foredate, actualdate) as delay_days,
			isnull(wbs_code,'-') as wbs_code,
			isnull(deginer,'-') as deginer,
			isnull(step,'-') as work_step,
			case when remark = '' then '-' else remark end as remark
		from (
			select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date,
			     case when fore_date='' then plan_date
			     	when fore_date is null then plan_date
			     	else fore_date
			     	end foredate
			             , sub1.actual_date, 
			     case when actual_date='' then Convert(varchar(10),dbo.returnLocalDate(Getdate()),112)
			     	when actual_date is null then Convert(varchar(10),dbo.returnLocalDate(Getdate()),112)
			     	else actual_date
			     	end actualdate,
			             sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			and del_yn!='Y'
			group by prj_id, doc_id)a1
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id	
			and a.doc_type='DCI'	
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
			<!-- and actual_date <![CDATA[ <= ]]> #{cut_off_date} -->
			and plan_date <![CDATA[ <= ]]> #{cut_off_date}
			and plan_date != ''
			<if test='allBehindList.equals("All")'>
				and ( ( plan_date <![CDATA[ < ]]> actual_date ) or ( actual_date is null or actual_date='' ) )
			</if>
			<if test='allBehindList.equals("")'>
				and ( actual_date is null or actual_date='' )			
			</if>
		) aa
		<!-- where ((actual_date!='' or actual_date is not null) and foredate <![CDATA[ < ]]> actual_date) or (actual_date='' or actual_date is null) -->
		where 1=1
		<if test='discipline!=null &amp;&amp; !discipline.equals("0")'>
			and discip_code_id = #{discipline}
		</if>
		<if test='workStep!=null &amp;&amp; !workStep.equals("0")'>
			and step_code_id = #{workStep}
		</if>
		group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,step,plan_date,actual_date,fore_date,foredate,actualdate,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code
		order by discipline asc,doc_no asc,plan_date asc
	</select>
	
	<select id="PrjReportEngineeringData_5" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
				isnull(tr_no,'-') as tr_no,
				isnull(rev_no,'-') as rev_no,
				isnull(send_date,'-') as tr_date,
				isnull(inout,'-') as inout,
				isnull(tr_issuepur,'-') as tr_issuepur,
				isnull(rtn_status_code,'-') as rtn_status_code,
				isnull(reg_id,'-') as originator,
				isnull(discipline,'_') as discipline,
				isnull(tr_remark,'-') as tr_remark,
				isnull(doc_no,'-') as doc_no,
				isnull(rev_no,'-') as currentRevNo,
				isnull(category,'-') as category,
				isnull(title,'-') as title,
				case when remark = '' then '-' else remark end as remark
			from (
				select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,sub1.reg_id,tr_remark,
						   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
				         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
				     , sub1.wbs_code_id, sub1.discip_code_id
				     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
					 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
				     , sub1.folder_id, sub1.doc_type_id
				             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
				     , sub1.designer_id
				 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
				  from p_users u
				       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
				       where u.user_id = sub1.designer_id) as deginer
				     , sub1.size_code_id
				     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
				     , sub1.step_code_id
				             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
				             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
				     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
				             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
							  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
				     , pptio.tr_no
				     , pptio.tr_issuepur_code_id
					 , pptfo.rev_no as issued_rev_no
					 , pptio.send_date as issued_send_date
					 , pptfo.rtn_status_code_id
					 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
				     ,(select set_code from p_prj_code_settings c where c.prj_id=sub1.prj_id and c.set_code_type='TR ISSUE PURPOSE' and c.set_code_id=tr_issuepur_code_id) as tr_issuepur
				     , pptio.send_date
				     , sub1.remark
					 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
				from
				(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
				from p_prj_document_index a
	 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
				     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
				     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
				where 1=1
				and del_yn!='Y'
				group by prj_id, doc_id)a1
				where a.prj_id = #{prj_id}
				and a.prj_id = a1.prj_id
				and a.doc_id  = a1.doc_id
				and a.rev_id  = a1.rev_id	
				and a.doc_type='DCI'	
				)sub1
				join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id<!-- and pptio.inout = 'OUT' -->	
				     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
				join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
				     where sub1.prj_id = #{prj_id}
				<if test='durationCheck != "All"'>
					and send_date >= #{date_s} and send_date <![CDATA[ <= ]]>  #{date_d}
				</if>
				<if test='discipline!=null &amp;&amp; !discipline.equals("0")'>
					and discip_code_id = #{discipline}
				</if>
			) aa
			group by tr_no,rev_no,send_date,inout,tr_issuepur,rtn_status_code,discipline,doc_no,category,title,remark,reg_id,tr_remark
			order by discipline asc,doc_no asc
	</select>
	
	<select id="PrjReportEngineeringData_6_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			count(*) as total_index,
			sum( CAST(wgtval AS INT)) as wgtval
			from (
				select
				isnull(discip_code,'-') as discip_code,
				isnull(discipline,'_') as discipline,
				isnull(doc_id,'-') as doc_id,
				isnull(doc_no,'-') as doc_no,
				isnull(rev_no,'-') as rev_no,
				isnull(title,'-') as title,
				isnull(tr_issuepur,'-') as tr_issuepur,
				isnull(plan_date,'-') as plan_date,
				isnull(actual_date,'-') as actual_date,
				isnull(wbs_code,'-') as wbs_code,
				isnull(doc_type,'-') as doc_type,
				isnull(doc_size,'-') as doc_size,
				isnull(deginer,'-') as deginer,
				isnull(tr_no,'-') as tr_no,
				isnull(send_date,'-') as send_date,
				case when remark = '' then '-' else remark end as remark,
				isnull(wgtval, '0') as wgtval,
				isnull(step_code_id,'-') as step_code_id,
				isnull(step,'-') as work_step,
				isnull(step_per,'-') as step_per,
				case when (actual_date != '' and actual_date is not null) then '1' else '0' end as checkCnt,
				case when actual_date >= #{cut_off_date} then '1' else '0' end as cutOffCnt
			from (
				select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
						   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
				         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
				     , sub1.wbs_code_id, sub1.discip_code_id
				     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
					 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
				     , sub1.folder_id, sub1.doc_type_id
				             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
				     , sub1.designer_id
				 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
				  from p_users u
				       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
				       where u.user_id = sub1.designer_id) as deginer
				     , sub1.size_code_id
				     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
				     , sub1.step_code_id
				             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
				             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
				     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
				             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
							  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
				     , pptio.tr_no
				     , pptio.tr_issuepur_code_id
					 , pptfo.rev_no as issued_rev_no
					 , pptio.send_date as issued_send_date
					 , pptfo.rtn_status_code_id
					 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
				     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
				     , pptio.send_date
				     , sub1.remark
					 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
				from
				(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
				from p_prj_document_index a
	 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
				     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
				     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
				where 1=1
				and del_yn!='Y'
				group by prj_id, doc_id)a1
				,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
				where a.prj_id = #{prj_id}
				and a.prj_id = a1.prj_id
				and a.doc_id  = a1.doc_id
				and a.rev_id  = a1.rev_id	
				and a.doc_type='DCI'	
				and b.category_cd_id = a2.set_code_id
				and a2.set_val2!='N'
				)sub1
				left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
				     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
				join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
				     where sub1.prj_id = #{prj_id}
			) aa
			where actual_date <![CDATA[ <= ]]> #{cut_off_date}
			group by folder_id,discipline,doc_id, doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per
		) zz
		group by discip_code, discipline
		order by discip_code asc
	</select>
	<select id="getEngStepCount" resultType="int" parameterType="ReportVo">
		select count(*) from p_prj_code_settings where prj_id=#{prj_id} and set_code_type='ENGINEERING STEP'	
	</select>
	<select id="getEngStepList" resultType="PrjCodeSettingsVO" parameterType="ReportVo">
		select * from p_prj_code_settings where prj_id=#{prj_id} and set_code_type='ENGINEERING STEP'
		order by set_order asc
	</select>
	<select id="PrjReportEngineeringData_6" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			isnull(doc_id,'-') as doc_id,
			isnull(doc_no,'-') as doc_no,
			isnull(rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(tr_issuepur,'-') as tr_issuepur,
			isnull(plan_date,'-') as plan_date,
			isnull(actual_date,'-') as actual_date,
			isnull(wbs_code,'-') as wbs_code,
			isnull(doc_type,'-') as doc_type,
			isnull(doc_size,'-') as doc_size,
			isnull(deginer,'-') as deginer,
			isnull(tr_no,'-') as tr_no,
			isnull(send_date,'-') as send_date,
			case when remark = '' then '-' else remark end as remark,
			isnull(wgtval, '0') as wgtval,
			isnull(step_code_id,'-') as step_code_id,
			isnull(step,'-') as work_step,
			isnull(step_per,'-') as step_per,
			case when (actual_date != '' and actual_date is not null) then '1' else '0' end as checkCnt,
			case when <!-- actual_date <![CDATA[ <= ]]> #{cut_off_date}
				and --> plan_date <![CDATA[ <= ]]> #{cut_off_date}
			and plan_date != ''
				and (actual_date is null or actual_date='')
			then '1' else '0' end as cutOffCnt
		from (
			select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			and del_yn!='Y'
			group by prj_id, doc_id)a1
			,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id	
			and a.doc_type='DCI'	
			and b.category_cd_id = a2.set_code_id
			and a2.set_val2!='N'
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
		) aa
		where discip_code=#{discip_code}
		and actual_date <![CDATA[ <= ]]> #{cut_off_date}
		group by folder_id,discipline,doc_id, doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,set_order
		order by discipline, doc_no,
		set_order asc
	</select>
	
	<select id="PrjReportEngineeringData_6_1" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
select doc_id from
		(select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			and del_yn!='Y'
			group by prj_id, doc_id)a1
			,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id	
			and a.doc_type='DCI'	
			and b.category_cd_id = a2.set_code_id
			and a2.set_val2!='N'
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
			     )sub2
		<!-- where actual_date <= '20220518' -->
		where discip_code=#{discip_code}
		group by doc_id
	</select>
	
	<select id="PrjReportEngineeringData_7" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discipline,'_') as discipline,
			isnull(step,'-') as work_step,
			isnull(doc_no,'-') as doc_no,
			isnull(aa.rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(category,'-') as category,
			case when plan_date = '' then '-' else plan_date end as plan_date,
			case when actual_date = '' then '-' else actual_date end as actual_date,
			isnull(tr_no,'-') as tr_no,
			isnull(deginer,'-') as deginer,
			case when remark = '' then '-' else remark end as remark
		from (
			select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			and del_yn!='Y'
			group by prj_id, doc_id)a1
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id		
			and a.doc_type='DCI'
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
			     	and (actual_date!='' or actual_date is not null)
			<if test='!discipline.equals("0")'>
				and discip_code_id = #{discipline}
			</if>
			<if test='durationCheck != "All"'>
				and actual_date >= #{date_s} and actual_date <![CDATA[ <= ]]>  #{date_d}
			</if>
		) aa
		group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,step,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code
		order by discipline asc,doc_no asc,plan_date asc
	</select>
	
	<select id="PrjReportEngineeringData_8_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
	 	select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			count(*) as total_index,
			sum( CAST(wgtval AS INT)) as wgtval
			from (
			select
						isnull(discip_code,'-') as discip_code,
						isnull(discipline,'_') as discipline,
						isnull(doc_no,'-') as doc_no,
						isnull(rev_no,'-') as rev_no,
						isnull(title,'-') as title,
						isnull(tr_issuepur,'-') as tr_issuepur,
						isnull(plan_date,'-') as plan_date,
						isnull(actual_date,'-') as actual_date,
						isnull(wbs_code,'-') as wbs_code,
						isnull(doc_type,'-') as doc_type,
						isnull(doc_size,'-') as doc_size,
						isnull(deginer,'-') as deginer,
						isnull(tr_no,'-') as tr_no,
						isnull(send_date,'-') as send_date,
						case when remark = '' then '-' else remark end as remark,
						isnull(wgtval, '1') as wgtval,
						isnull(step_code_id,'-') as step_code_id,
						isnull(step,'-') as work_step,
						isnull(step_per,'-') as step_per
					from (
								select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
								   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
						         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
						     , sub1.wbs_code_id, sub1.discip_code_id
						     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
							 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
						     , sub1.folder_id, sub1.doc_type_id
						             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
						     , sub1.designer_id
						 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
						  from p_users u
						       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
						       where u.user_id = sub1.designer_id) as deginer
						     , sub1.size_code_id
						     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
						     , sub1.step_code_id
						             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
						             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
						     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
						             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
									  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
						     , pptio.tr_no
						     , pptio.tr_issuepur_code_id
							 , pptfo.rev_no as issued_rev_no
							 , pptio.send_date as issued_send_date
							 , pptfo.rtn_status_code_id
							 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
						     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
						     , pptio.send_date
						     , sub1.remark
							 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
						from
						(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
						from p_prj_document_index a
			 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
						     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
						     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
						where 1=1
						and del_yn!='Y'
						group by prj_id, doc_id)a1
						where a.prj_id = #{prj_id}
						and a.prj_id = a1.prj_id
						and a.doc_id  = a1.doc_id
						and a.rev_id  = a1.rev_id		
						and a.doc_type='DCI'
						)sub1
						left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
						     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
						join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
						     where sub1.prj_id = #{prj_id}
					     	and (actual_date!='' or actual_date is not null)
								<if test='durationCheck != "All"'>
									and actual_date >= #{date_s} and actual_date <![CDATA[ <= ]]>  #{date_d}
								</if>
					) aa
					where discip_code is not null
					group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per
		) zz
		group by discip_code, discipline
	</select>
	
	<select id="PrjReportEngineeringData_8" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			isnull(doc_no,'-') as doc_no,
			isnull(rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(tr_issuepur,'-') as tr_issuepur,
			isnull(plan_date,'-') as plan_date,
			isnull(actual_date,'-') as actual_date,
			isnull(fore_date,'-') as fore_date,
			isnull(wbs_code,'-') as wbs_code,
			isnull(doc_type,'-') as doc_type,
			isnull(doc_size,'-') as doc_size,
			isnull(deginer,'-') as deginer,
			isnull(tr_no,'-') as tr_no,
			isnull(send_date,'-') as send_date,
			case when remark = '' then '-' else remark end as remark,
			isnull(wgtval, '0') as wgtval,
			isnull(step_code_id,'-') as step_code_id,
			isnull(step,'-') as work_step,
			isnull(step_per,'-') as step_per,
			case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
			case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
			case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
		from (select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
						   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
				         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
				     , sub1.wbs_code_id, sub1.discip_code_id
				     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
					 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
				     , sub1.folder_id, sub1.doc_type_id
				             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
				     , sub1.designer_id
				 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
				  from p_users u
				       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
				       where u.user_id = sub1.designer_id) as deginer
				     , sub1.size_code_id
				     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
				     , sub1.step_code_id
				             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
				             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
				     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
				             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
							  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
				     , pptio.tr_no
				     , pptio.tr_issuepur_code_id
					 , pptfo.rev_no as issued_rev_no
					 , pptio.send_date as issued_send_date
					 , pptfo.rtn_status_code_id
					 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
				     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
				     , pptio.send_date
				     , sub1.remark
					 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
				from
				(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
				from p_prj_document_index a
	 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
				     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
				     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
				where 1=1
				and del_yn!='Y'
				group by prj_id, doc_id)a1
				where a.prj_id = #{prj_id}
				and a.prj_id = a1.prj_id
				and a.doc_id  = a1.doc_id
				and a.rev_id  = a1.rev_id	
				and a.doc_type='DCI'	
				)sub1
				left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
				     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
				join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
				     where sub1.prj_id = #{prj_id}
			     	and (actual_date!='' or actual_date is not null)
								<if test='durationCheck != "All"'>
									and actual_date >= #{date_s} and actual_date <![CDATA[ <= ]]>  #{date_d}
								</if>
		) aa
		where discip_code=#{discip_code}
		group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date,set_order
		order by discipline, doc_no, 
		set_order asc
	</select>
	
	<select id="PrjReportEngineeringData_9_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			sum( CAST(plan_cnt AS INT)) as plan_cnt,
			sum( CAST(fore_cnt AS INT)) as fore_cnt,
			sum( CAST(actual_cnt AS INT)) as actual_cnt,
			count(*) as total_index,
			sum(CONVERT(INT,isnull(wgtval, '0')) )as wgtval
			from
			(			
  			     select
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '0') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when plan_date != '' then '1' else '0' end as plan_cnt,
                           case when fore_date != '' then '1' else '0' end as fore_cnt,
                           case when actual_date != '' then '1' else '0' end as actual_cnt,
                           CONVERT(CHAR(8), DATEADD(Day, (DATEPART(WEEKDAY, CONVERT(DATE ,#{cut_off_date})) - DATEPART(dw, send_date)), send_date), 112) as week
                     from (
                          select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'	
							and b.category_cd_id = a2.set_code_id
							and a2.set_val2!='N'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              ) aaaa
              group by discip_code, discipline
              order by discip_code asc
	</select>
	<select id="PrjReportEngineeringData_9_new" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			isnull(doc_id,'-') as doc_id,
			isnull(doc_no,'-') as doc_no,
			isnull(rev_no,'-') as rev_no,
			isnull(title,'-') as title,
			isnull(tr_issuepur,'-') as tr_issuepur,
			isnull(plan_date,'-') as plan_date,
			isnull(actual_date,'-') as actual_date,
			isnull(wbs_code,'-') as wbs_code,
			isnull(doc_type,'-') as doc_type,
			isnull(doc_size,'-') as doc_size,
			isnull(deginer,'-') as deginer,
			isnull(tr_no,'-') as tr_no,
			isnull(send_date,'-') as send_date,
			case when remark = '' then '-' else remark end as remark,
			isnull(wgtval, '0') as wgtval,
			isnull(step_code_id,'-') as step_code_id,
			isnull(step,'-') as work_step,
			isnull(step_per,'-') as step_per,
			case when (actual_date != '' and actual_date is not null) then '1' else '0' end as checkCnt,
			case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
			case when actual_date <![CDATA[ <= ]]> #{cut_off_date}
				and plan_date <![CDATA[ <= ]]> #{cut_off_date}
			and plan_date != ''
				and (actual_date is null or actual_date='')
			then '1' else '0' end as cutOffCnt
		from (
			select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
			         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
			     , sub1.wbs_code_id, sub1.discip_code_id
			     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
				 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
			     , sub1.folder_id, sub1.doc_type_id
			             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
			     , sub1.designer_id
			 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
			  from p_users u
			       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
			       where u.user_id = sub1.designer_id) as deginer
			     , sub1.size_code_id
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
			     , sub1.step_code_id
			             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
			             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
			     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
			             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
						  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
			     , pptio.tr_no
			     , pptio.tr_issuepur_code_id
				 , pptfo.rev_no as issued_rev_no
				 , pptio.send_date as issued_send_date
				 , pptfo.rtn_status_code_id
				 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
			     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
			     , pptio.send_date
			     , sub1.remark
				 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
			from
			(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
			from p_prj_document_index a
 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
			     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
			     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
			where 1=1
			and del_yn!='Y'
			group by prj_id, doc_id)a1
			,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
			where a.prj_id = #{prj_id}
			and a.prj_id = a1.prj_id
			and a.doc_id  = a1.doc_id
			and a.rev_id  = a1.rev_id	
			and a.doc_type='DCI'	
			and b.category_cd_id = a2.set_code_id
			and a2.set_val2!='N'
			)sub1
			left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
			     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
			join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
			     where sub1.prj_id = #{prj_id}
		) aa
		where discip_code=#{discip_code}
		and plan_date <![CDATA[ <= ]]> #{cut_off_date}
		group by folder_id,discipline,doc_id, doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date,set_order
		order by discipline, doc_no,
		set_order asc
	</select>
	<select id="PrjReportEngineeringData_9" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select count(*) as total,
 					count(case when workdone_cnt=${step_cnt} then 1 end) as actual_cnt,
 					'plan' as step
 			from
 				(select 
 					count(step_code_id) as workdone_cnt from
 					(
 					select
 							doc_id,
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
                           case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
                           case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
                     from (
                           select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'	
							and b.category_cd_id = a2.set_code_id
							and a2.set_val2!='N'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     where plan_date <![CDATA[ <= ]]> #{date_s} and discip_code=#{discip_code}
                     group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              	)aaaa
              	where (plan_date != '' and plan_date is not null)
              	group by doc_id
          )main1
          union all
 			select count(*) as total,
 					count(case when workdone_cnt=${step_cnt} then 1 end) as actual_cnt,
 					'actual' as step
 			from
 				(select 
 					count(step_code_id) as workdone_cnt from
 					(
 					select
 							doc_id,
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
                           case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
                           case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
                     from (
                           select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'
							and b.category_cd_id = a2.set_code_id
							and a2.set_val2!='N'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     where plan_date <![CDATA[ <= ]]> #{date_s} and discip_code=#{discip_code}
                     group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              	)aaaa
              	where (actual_date != '' and actual_date is not null)
              	group by doc_id
          )main2
          union all
          select count(*) as total,
 					count(case when workdone_cnt=${step_cnt} then 1 end) as actual_cnt,
 					'fore' as step
 			from
 				(select 
 					count(step_code_id) as workdone_cnt from
 					(
 					select
 							doc_id,
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
                           case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
                           case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
                     from (
                           select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'
							and b.category_cd_id = a2.set_code_id
							and a2.set_val2!='N'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     where plan_date <![CDATA[ <= ]]> #{date_s} and discip_code=#{discip_code}
                     group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              	)aaaa
              	where (fore_date != '' and fore_date is not null)
              	group by doc_id
          )main3
    </select>
	<select id="PrjReportEngineeringData_9_1" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			sum(CONVERT(INT,isnull(wgtval, '0')) )as wgtval
			from
			(			
  			     select
                           isnull(discip_code,'-') as discip_code,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(wgtval, '0') as wgtval
                     from (
                          select (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
								,(select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
								,(select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,( select isnull(set_val2,'Y') as set_val2,set_code_id from p_prj_code_settings c1 where c1.prj_id=#{prj_id} and c1.set_code_type ='DOC.CATEGORY')a2
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id	
							and a.doc_type='DCI'	
							and b.category_cd_id = a2.set_code_id
							and a2.set_val2!='N'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     group by discip_code,wbs_code,wgtval
              ) aaaa
              group by discip_code
              order by discip_code asc
	</select>
	
	<select id="PrjReportEngineeringData_10_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			isnull(discipline,'_') as discipline,
			sum( CAST(plan_cnt AS INT)) as plan_cnt,
			sum( CAST(fore_cnt AS INT)) as fore_cnt,
			sum( CAST(actual_cnt AS INT)) as actual_cnt,
			count(*) as total_index,
			sum(CONVERT(INT,isnull(wgtval, '1')) )as wgtval
			from
			(			
  			     select
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when plan_date != '' then '1' else '0' end as plan_cnt,
                           case when fore_date != '' then '1' else '0' end as fore_cnt,
                           case when actual_date != '' then '1' else '0' end as actual_cnt,
                           CONVERT(CHAR(8), DATEADD(Day, (DATEPART(WEEKDAY, CONVERT(DATE ,#{cut_off_date})) - DATEPART(dw, send_date)), send_date), 112) as week
                     from (
                          select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              ) aaaa
              group by discip_code, discipline
              order by discip_code asc
	</select>
	<select id="PrjReportEngineeringData_10" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select count(*) as total,
 					count(case when workdone_cnt=${step_cnt} then 1 end) as actual_cnt,
 					'plan' as step
 			from
 				(select 
 					count(step_code_id) as workdone_cnt from
 					(
 					select
 							doc_id,
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
                           case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
                           case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
                     from (
                           select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     where plan_date <![CDATA[ <= ]]> #{date_s} and discip_code=#{discip_code}
                     group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              	)aaaa
              	where (plan_date != '' and plan_date is not null)
              	group by doc_id
          )main1
          union all
 			select count(*) as total,
 					count(case when workdone_cnt=${step_cnt} then 1 end) as actual_cnt,
 					'actual' as step
 			from
 				(select 
 					count(step_code_id) as workdone_cnt from
 					(
 					select
 							doc_id,
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
                           case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
                           case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
                     from (
                           select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id	
							and a.doc_type='DCI'	
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     where plan_date <![CDATA[ <= ]]> #{date_s} and discip_code=#{discip_code}
                     group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              	)aaaa
              	where (actual_date != '' and actual_date is not null)
              	group by doc_id
          )main2
          union all
          select count(*) as total,
 					count(case when workdone_cnt=${step_cnt} then 1 end) as actual_cnt,
 					'fore' as step
 			from
 				(select 
 					count(step_code_id) as workdone_cnt from
 					(
 					select
 							doc_id,
                           isnull(discip_code,'-') as discip_code,
						   isnull(discipline,'_') as discipline,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
						   isnull(tr_issuepur,'-') as tr_issuepur,
						   isnull(plan_date,'-') as plan_date,
						   isnull(actual_date,'-') as actual_date,
						   isnull(fore_date,'-') as fore_date,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(doc_type,'-') as doc_type,
						   isnull(doc_size,'-') as doc_size,
						   isnull(deginer,'-') as deginer,
						   isnull(tr_no,'-') as tr_no,
						   isnull(send_date,'-') as send_date,
                           case when remark = '' then '-' else remark end as remark,
                           isnull(wgtval, '1') as wgtval,
                           isnull(step_code_id,'-') as step_code_id,
						   isnull(step,'-') as work_step,
						   isnull(step_per,'-') as step_per,
                           case when (plan_date != '' and plan_date is not null) then '1' else '0' end as plan_cnt,
                           case when (fore_date != '' and fore_date is not null) then '1' else '0' end as fore_cnt,
                           case when (actual_date != '' and actual_date is not null) then '1' else '0' end as actual_cnt
                     from (
                           select sub1.prj_id, sub1.doc_id, sub1.doc_no, sub1.title, sub1.rev_code_id, sub1.trans_ref_doc_id, sub1.rev_id,pptio.inout as inout,
									   ( select set_code from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and sub1.category_cd_id = c1.set_code_id) category
							         , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and sub1.rev_code_id = c1.set_code_id) rev_no
							     , sub1.wbs_code_id, sub1.discip_code_id
							     , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							     , sub1.folder_id, sub1.doc_type_id
							             , (select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = sub1.doc_type_id) doc_type
							     , sub1.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)
							  from p_users u
							       left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code
							       where u.user_id = sub1.designer_id) as deginer
							     , sub1.size_code_id
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = sub1.size_code_id) doc_size
							     , sub1.step_code_id
							             ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step
							             ,(select c1.set_order  from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) set_order
							     , sub1.plan_date, sub1.fore_date, sub1.actual_date, sub1.step_seq
							             , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
							     , pptio.tr_no
							     , pptio.tr_issuepur_code_id
								 , pptfo.rev_no as issued_rev_no
								 , pptio.send_date as issued_send_date
								 , pptfo.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and pptfo.rtn_status_code_id = c1.set_code_id) rtn_status_code
							     ,(select c1.set_code as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = sub1.category_cd_id) tr_issuepur
							     , pptio.send_date
							     , sub1.remark
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where sub1.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = sub1.step_code_id) step_per
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id	
							and a.doc_type='DCI'	
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     where plan_date <![CDATA[ <= ]]> #{date_s} and discip_code=#{discip_code}
                     group by discipline,doc_id,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date
              	)aaaa
              	where (fore_date != '' and fore_date is not null)
              	group by doc_id
          )main3
    </select>
	<select id="PrjReportEngineeringData_10_1" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discip_code,'-') as discip_code,
			sum(CONVERT(INT,isnull(wgtval, '0')) )as wgtval
			from
			(			
  			     select
                           isnull(discip_code,'-') as discip_code,
                           isnull(wbs_code,'-') as wbs_code,
                           isnull(wgtval, '0') as wgtval
                     from (
                          select (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wbs_code
								,(select c1.wgtval as set_desc from p_prj_wbs_code c1 where sub1.prj_id = c1.prj_id and c1.wbs_code_id = sub1.wbs_code_id) wgtval
								,(select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=sub1.prj_id and ppdi.discip_code_id=sub1.discip_code_id) discip_code
							from
							(select a.*,b.wbs_code_id, b.category_cd_id, b.discip_code_id, b.doc_type_id, b.designer_id, b.size_code_id, b.remark, c.step_code_id,c.plan_date, c.fore_date, c.actual_date, c.step_seq
							from p_prj_document_index a
				 				join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id
							     left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id
							     ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id
							and a.doc_id  = a1.doc_id
							and a.rev_id  = a1.rev_id		
							and a.doc_type='DCI'
							)sub1
							left outer join p_prj_tr_file pptfo join p_prj_tr_info pptio on pptio.prj_id = #{prj_id} and pptfo.prj_id = pptio.prj_id and pptfo.tr_id = pptio.tr_id and pptio.inout = 'OUT'		
							     on pptfo.prj_id = #{prj_id} and sub1.prj_id = pptfo.prj_id and sub1.doc_id = pptfo.doc_id and sub1.rev_id = pptfo.rev_id
							join p_prj_folder_info ppfi on sub1.prj_id=ppfi.prj_id and sub1.folder_id=ppfi.folder_id and folder_type='DCC'
							     where sub1.prj_id = #{prj_id}
                     ) aa
                     group by discip_code,wbs_code,wgtval
              ) aaaa
              group by discip_code
              order by discip_code asc
	</select>
	<select id="PrjReportEngineeringData_11_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
	
		select 
			isnull(discipline,'_') as discipline,
			isnull(wbs_code,'-') as wbs_code,
			isnull(wbs_desc,'-') as wbs_desc,
			sum(checkCnt) as checkCnt,
			sum( CAST(plan_cnt AS INT)) as plan_cnt,
			sum( CAST(actual_cnt AS INT)) as actual_cnt
			from 
			(
			select
							isnull(discipline,'_') as discipline,
							isnull(wbs_code,'-') as wbs_code,
						   isnull(doc_no,'-') as doc_no,
						   isnull(rev_no,'-') as rev_no,
						   isnull(title,'-') as title,
							isnull(tr_issuepur,'-') as tr_issuepur,
							isnull(plan_date,'-') as plan_date,
						    isnull(actual_date,'-') as actual_date,
						    isnull(fore_date,'-') as fore_date,
							isnull(doc_type,'-') as doc_type,
						    isnull(doc_size,'-') as doc_size,
						    isnull(deginer,'-') as deginer,
						    isnull(tr_no,'-') as tr_no,
						    isnull(send_date,'-') as send_date,
							case when remark = '' then '-' else remark end as remark,
							isnull(wgtval, '1') as wgtval,
							isnull(step_code_id,'-') as step_code_id,
						    isnull(step,'-') as work_step,
						    isnull(step_per,'-') as step_per,
							case when plan_date >= #{cut_off_date} then '1' else '0' end as plan_cnt,
							case when fore_date != '' then '1' else '0' end as fore_cnt,
							case when actual_date >= #{cut_off_date} then '1' else '0' end as actual_cnt,
							count(*) as checkCnt,
							isnull(wbs_desc,'-') as wbs_desc
						from ( 
							select a.prj_id, a.doc_id, a.doc_no, a.title, a.rev_code_id, a.trans_ref_doc_id, a.rev_id,tr.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and b.category_cd_id = c1.set_code_id) category
									 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and a.rev_code_id = c1.set_code_id) rev_no
								 , b.wbs_code_id, b.discip_code_id
								 , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discip_code
								 , b.folder_id, b.doc_type_id 
										 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = b.doc_type_id) doc_type     
								 , b.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)  
							  from p_users u
								   left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code 
								   where u.user_id = b.designer_id) as deginer      
								 , b.size_code_id
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = b.size_code_id) doc_size
								 , c.step_code_id
										 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step     
										 ,(select c1.set_order  from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) set_order             
								 , c.plan_date, c.fore_date, c.actual_date, c.step_seq
										 , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_code
										  , (select c1.wbs_desc as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_desc
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wgtval
								 , tr.tr_no 
								 , tr.tr_issuepur_code_id
								 , tr.issued_rev_no
								 , tr.issued_send_date
								 , tr.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and tr.rtn_status_code_id = c1.set_code_id) rtn_status_code
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = b.category_cd_id) tr_issuepur     
								 , tr.send_date
								 , b.remark 
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step_per
							from p_prj_document_index a
								 join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id 
								 left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id  
								 ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1 
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,(select tf.prj_id, tf.doc_id, tf.rev_id, tr.tr_no , tf.issue_step, tr.tr_issuepur_code_id,tr.send_date,tr.send_date as issued_send_date, tf.rev_no  as issued_rev_no, tf.rtn_status_code_id, inout 
							  from p_prj_tr_file tf
							  join p_prj_tr_info tr on tf.prj_id  = #{prj_id} and tf.prj_id = tr.prj_id 
													   and tf.tr_id = tr.tr_id and tr.inout='OUT') tr      
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id 
							and a.doc_id  = a1.doc_id 
							and a.rev_id  = a1.rev_id 
							and a.prj_id = tr.prj_id 
							and a.doc_id = tr.doc_id 
							and a.rev_id = tr.rev_id 
						) aa
						group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date, wbs_desc
			) zz
			where wbs_code != '-'
			group by discipline, wbs_code, wbs_desc
	</select>
	
	<select id="PrjReportEngineeringData_11" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
			select
							isnull(discipline,'_') as discipline,
							isnull(remark,'-') as wbs_code,
							isnull(doc_no,'-') as doc_no,
							isnull(rev_no,'-') as rev_no,
							isnull(title,'-') as title,
							isnull(tr_issuepur,'-') as tr_issuepur,
							isnull(plan_date,'-') as plan_date,
							isnull(actual_date,'-') as actual_date,
							isnull(fore_date,'-') as fore_date,
							isnull(doc_type,'-') as doc_type,
							isnull(doc_size,'-') as doc_size,
							isnull(deginer,'-') as deginer,
							isnull(tr_no,'-') as tr_no,
							isnull(send_date,'-') as send_date,
							case when remark = '' then '-' else remark end as remark,
							isnull(wgtval, '1') as wgtval,
							isnull(step_code_id,'-') as step_code_id,
							isnull(step,'-') as work_step,
							isnull(step_per,'-') as step_per,
							case when plan_date >= #{cut_off_date} then '1' else '0' end as plan_cnt,
							case when fore_date != '' then '1' else '0' end as fore_cnt,
							case when actual_date >= #{cut_off_date} then '1' else '0' end as actual_cnt,
							isnull(wbs_desc,'-') as wbs_desc,
							count(*) as checkCnt
						from ( 
							select a.prj_id, a.doc_id, a.doc_no, a.title, a.rev_code_id, a.trans_ref_doc_id, a.rev_id,tr.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and b.category_cd_id = c1.set_code_id) category
									 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and a.rev_code_id = c1.set_code_id) rev_no
								 , b.wbs_code_id, b.discip_code_id
								 , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discip_code
								 , b.folder_id, b.doc_type_id 
										 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = b.doc_type_id) doc_type     
								 , b.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)  
							  from p_users u
								   left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code 
								   where u.user_id = b.designer_id) as deginer      
								 , b.size_code_id
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = b.size_code_id) doc_size
								 , c.step_code_id
										 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step     
										 ,(select c1.set_order  from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) set_order             
								 , c.plan_date, c.fore_date, c.actual_date, c.step_seq
										 , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_code
										  , (select c1.wbs_desc as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_desc
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wgtval
								 , tr.tr_no 
								 , tr.tr_issuepur_code_id
								 , tr.issued_rev_no
								 , tr.issued_send_date
								 , tr.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and tr.rtn_status_code_id = c1.set_code_id) rtn_status_code
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = b.category_cd_id) tr_issuepur     
								 , tr.send_date
								 , b.remark 
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step_per
							from p_prj_document_index a
								 join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id 
								 left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id  
								 ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1 
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,(select tf.prj_id, tf.doc_id, tf.rev_id, tr.tr_no , tf.issue_step, tr.tr_issuepur_code_id,tr.send_date,tr.send_date as issued_send_date, tf.rev_no  as issued_rev_no, tf.rtn_status_code_id, inout 
							  from p_prj_tr_file tf
							  join p_prj_tr_info tr on tf.prj_id  = #{prj_id} and tf.prj_id = tr.prj_id 
													   and tf.tr_id = tr.tr_id and tr.inout='OUT') tr      
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id 
							and a.doc_id  = a1.doc_id 
							and a.rev_id  = a1.rev_id 
							and a.prj_id = tr.prj_id 
							and a.doc_id = tr.doc_id 
							and a.rev_id = tr.rev_id 
						) aa
						where wbs_code=#{wbs_code}
						group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date, wbs_desc
	</select>
	
	<select id="PrjReportEngineeringData_12_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select 
			isnull(discipline,'_') as discipline,
			isnull(wbs_code,'-') as wbs_code,
			isnull(wbs_desc,'-') as wbs_desc,
			sum(checkCnt) as checkCnt,
			sum( CAST(plan_cnt AS INT)) as plan_cnt,
			sum( CAST(actual_cnt AS INT)) as actual_cnt
			from 
			(
			select
							isnull(discipline,'_') as discipline,
							isnull(wbs_code,'-') as wbs_code,
						    isnull(doc_no,'-') as doc_no,
						    isnull(rev_no,'-') as rev_no,
						    isnull(title,'-') as title,
							isnull(tr_issuepur,'-') as tr_issuepur,
							isnull(plan_date,'-') as plan_date,
						    isnull(actual_date,'-') as actual_date,
						    isnull(fore_date,'-') as fore_date,
							isnull(doc_type,'-') as doc_type,
						    isnull(doc_size,'-') as doc_size,
						    isnull(deginer,'-') as deginer,
						    isnull(tr_no,'-') as tr_no,
						    isnull(send_date,'-') as send_date,
							case when remark = '' then '-' else remark end as remark,
							isnull(wgtval, '1') as wgtval,
							isnull(step_code_id,'-') as step_code_id,
							'IFR,REVIEW,IFC' as work_step,
							isnull(step_per,'-') as step_per,
							case when plan_date >= #{cut_off_date} then '1' else '0' end as plan_cnt,
							case when fore_date != '' then '1' else '0' end as fore_cnt,
							case when actual_date >= #{cut_off_date} then '1' else '0' end as actual_cnt,
							count(*) as checkCnt,
							isnull(wbs_desc,'-') as wbs_desc
						from ( 
							select a.prj_id, a.doc_id, a.doc_no, a.title, a.rev_code_id, a.trans_ref_doc_id, a.rev_id,tr.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and b.category_cd_id = c1.set_code_id) category
									 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and a.rev_code_id = c1.set_code_id) rev_no
								 , b.wbs_code_id, b.discip_code_id
								 , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discip_code
								 , b.folder_id, b.doc_type_id 
										 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = b.doc_type_id) doc_type     
								 , b.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)  
							  from p_users u
								   left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code 
								   where u.user_id = b.designer_id) as deginer      
								 , b.size_code_id
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = b.size_code_id) doc_size
								 , c.step_code_id
										 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step     
										 ,(select c1.set_order  from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) set_order             
								 , c.plan_date, c.fore_date, c.actual_date, c.step_seq
										 , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_code
										  , (select c1.wbs_desc as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_desc
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wgtval
								 , tr.tr_no 
								 , tr.tr_issuepur_code_id
								 , tr.issued_rev_no
								 , tr.issued_send_date
								 , tr.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and tr.rtn_status_code_id = c1.set_code_id) rtn_status_code
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = b.category_cd_id) tr_issuepur     
								 , tr.send_date
								 , b.remark 
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step_per
							from p_prj_document_index a
								 join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id 
								 left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id  
								 ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1 
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,(select tf.prj_id, tf.doc_id, tf.rev_id, tr.tr_no , tf.issue_step, tr.tr_issuepur_code_id,tr.send_date,tr.send_date as issued_send_date, tf.rev_no  as issued_rev_no, tf.rtn_status_code_id, inout 
							  from p_prj_tr_file tf
							  join p_prj_tr_info tr on tf.prj_id  = #{prj_id} and tf.prj_id = tr.prj_id 
													   and tf.tr_id = tr.tr_id and tr.inout='OUT') tr      
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id 
							and a.doc_id  = a1.doc_id 
							and a.rev_id  = a1.rev_id 
							and a.prj_id = tr.prj_id 
							and a.doc_id = tr.doc_id 
							and a.rev_id = tr.rev_id 
						) aa
						group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date, wbs_desc
			) zz
			where wbs_code != '-'
			group by discipline, wbs_code, wbs_desc
	</select>
	
	<select id="PrjReportEngineeringData_12" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
							isnull(discipline,'_') as discipline,
							isnull(remark,'-') as wbs_code,
							isnull(doc_no,'-') as doc_no,
							isnull(rev_no,'-') as rev_no,
							isnull(title,'-') as title,
							isnull(tr_issuepur,'-') as tr_issuepur,
							isnull(plan_date,'-') as plan_date,
							isnull(actual_date,'-') as actual_date,
							isnull(fore_date,'-') as fore_date,
							isnull(doc_type,'-') as doc_type,
							isnull(doc_size,'-') as doc_size,
							isnull(deginer,'-') as deginer,
							isnull(tr_no,'-') as tr_no,
							isnull(send_date,'-') as send_date,
							case when remark = '' then '-' else remark end as remark,
							isnull(wgtval, '1') as wgtval,
							isnull(step_code_id,'-') as step_code_id,
							isnull(step,'-') as work_step,
							isnull(step_per,'-') as step_per,
							case when plan_date >= #{cut_off_date} then '1' else '0' end as plan_cnt,
							case when fore_date != '' then '1' else '0' end as fore_cnt,
							case when actual_date >= #{cut_off_date} then '1' else '0' end as actual_cnt,
							isnull(wbs_desc,'-') as wbs_desc,
							count(*) as checkCnt
						from ( 
							select a.prj_id, a.doc_id, a.doc_no, a.title, a.rev_code_id, a.trans_ref_doc_id, a.rev_id,tr.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and b.category_cd_id = c1.set_code_id) category
									 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and a.rev_code_id = c1.set_code_id) rev_no
								 , b.wbs_code_id, b.discip_code_id
								 , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discip_code
								 , b.folder_id, b.doc_type_id 
										 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = b.doc_type_id) doc_type     
								 , b.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)  
							  from p_users u
								   left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code 
								   where u.user_id = b.designer_id) as deginer      
								 , b.size_code_id
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = b.size_code_id) doc_size
								 , c.step_code_id
										 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step     
										 ,(select c1.set_order  from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) set_order             
								 , c.plan_date, c.fore_date, c.actual_date, c.step_seq
										 , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_code
										  , (select c1.wbs_desc as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_desc
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wgtval
								 , tr.tr_no 
								 , tr.tr_issuepur_code_id
								 , tr.issued_rev_no
								 , tr.issued_send_date
								 , tr.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and tr.rtn_status_code_id = c1.set_code_id) rtn_status_code
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = b.category_cd_id) tr_issuepur     
								 , tr.send_date
								 , b.remark 
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step_per
							from p_prj_document_index a
								 join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id 
								 left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id  
								 ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1 
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,(select tf.prj_id, tf.doc_id, tf.rev_id, tr.tr_no , tf.issue_step, tr.tr_issuepur_code_id,tr.send_date,tr.send_date as issued_send_date, tf.rev_no  as issued_rev_no, tf.rtn_status_code_id, inout 
							  from p_prj_tr_file tf
							  join p_prj_tr_info tr on tf.prj_id  = #{prj_id} and tf.prj_id = tr.prj_id 
													   and tf.tr_id = tr.tr_id and tr.inout='OUT') tr      
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id 
							and a.doc_id  = a1.doc_id 
							and a.rev_id  = a1.rev_id 
							and a.prj_id = tr.prj_id 
							and a.doc_id = tr.doc_id 
							and a.rev_id = tr.rev_id 
						) aa
						where wbs_code=#{wbs_code}
						and step in ( 'IFC', 'IFR', 'REVIEW' )
						group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date, wbs_desc
	</select>
	
	<select id="PrjReportEngineeringData_13_0" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
			isnull(discipline,'_') as discipline,
			isnull(wbs_code,'-') as wbs_code,
			isnull(wbs_desc,'-') as wbs_desc,
			doc_no,
			sum(checkCnt) as checkCnt,
			sum( CAST(plan_cnt AS INT)) as plan_cnt,
			sum( CAST(actual_cnt AS INT)) as actual_cnt
			from 
			(
			select
							isnull(discipline,'_') as discipline,
							isnull(wbs_code,'-') as wbs_code,
						    isnull(doc_no,'-') as doc_no,
						    isnull(rev_no,'-') as rev_no,
						    isnull(title,'-') as title,
							isnull(tr_issuepur,'-') as tr_issuepur,
							isnull(plan_date,'-') as plan_date,
						    isnull(actual_date,'-') as actual_date,
						    isnull(fore_date,'-') as fore_date,
							isnull(doc_type,'-') as doc_type,
						    isnull(doc_size,'-') as doc_size,
						    isnull(deginer,'-') as deginer,
						    isnull(tr_no,'-') as tr_no,
						    isnull(send_date,'-') as send_date,
							case when remark = '' then '-' else remark end as remark,
							isnull(wgtval, '1') as wgtval,
							isnull(step_code_id,'-') as step_code_id,
							'IFR,REVIEW,IFC' as work_step,
							isnull(step_per,'-') as step_per,
							case when plan_date >= #{cut_off_date} then '1' else '0' end as plan_cnt,
							case when fore_date != '' then '1' else '0' end as fore_cnt,
							case when actual_date >= #{cut_off_date} then '1' else '0' end as actual_cnt,
							count(*) as checkCnt,
							isnull(wbs_desc,'-') as wbs_desc
						from ( 
							select a.prj_id, a.doc_id, a.doc_no, a.title, a.rev_code_id, a.trans_ref_doc_id, a.rev_id,tr.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and b.category_cd_id = c1.set_code_id) category
									 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and a.rev_code_id = c1.set_code_id) rev_no
								 , b.wbs_code_id, b.discip_code_id
								 , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discip_code
								 , b.folder_id, b.doc_type_id 
										 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = b.doc_type_id) doc_type     
								 , b.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)  
							  from p_users u
								   left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code 
								   where u.user_id = b.designer_id) as deginer      
								 , b.size_code_id
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = b.size_code_id) doc_size
								 , c.step_code_id
										 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step     
										 ,(select c1.set_order  from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) set_order             
								 , c.plan_date, c.fore_date, c.actual_date, c.step_seq
										 , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_code
										  , (select c1.wbs_desc as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_desc
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wgtval
								 , tr.tr_no 
								 , tr.tr_issuepur_code_id
								 , tr.issued_rev_no
								 , tr.issued_send_date
								 , tr.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and tr.rtn_status_code_id = c1.set_code_id) rtn_status_code
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = b.category_cd_id) tr_issuepur     
								 , tr.send_date
								 , b.remark 
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step_per
							from p_prj_document_index a
								 join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id 
								 left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id  
								 ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1 
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,(select tf.prj_id, tf.doc_id, tf.rev_id, tr.tr_no , tf.issue_step, tr.tr_issuepur_code_id,tr.send_date,tr.send_date as issued_send_date, tf.rev_no  as issued_rev_no, tf.rtn_status_code_id, inout 
							  from p_prj_tr_file tf
							  join p_prj_tr_info tr on tf.prj_id  = #{prj_id} and tf.prj_id = tr.prj_id 
													   and tf.tr_id = tr.tr_id and tr.inout='OUT') tr      
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id 
							and a.doc_id  = a1.doc_id 
							and a.rev_id  = a1.rev_id 
							and a.prj_id = tr.prj_id 
							and a.doc_id = tr.doc_id 
							and a.rev_id = tr.rev_id 
						) aa
						group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date, wbs_desc
			) zz
			where wbs_code != '-'
			group by discipline, wbs_code, wbs_desc,doc_no
	</select>
	
	<select id="PrjReportEngineeringData_13" resultType="PrjReportEnginneeringVo" parameterType="ReportVo">
		select
							isnull(discipline,'_') as discipline,
							isnull(remark,'-') as wbs_code,
							isnull(doc_no,'-') as doc_no,
							isnull(rev_no,'-') as rev_no,
							isnull(title,'-') as title,
							isnull(tr_issuepur,'-') as tr_issuepur,
							isnull(plan_date,'-') as plan_date,
							isnull(actual_date,'-') as actual_date,
							isnull(fore_date,'-') as fore_date,
							isnull(doc_type,'-') as doc_type,
							isnull(doc_size,'-') as doc_size,
							isnull(deginer,'-') as deginer,
							isnull(tr_no,'-') as tr_no,
							isnull(send_date,'-') as send_date,
							case when remark = '' then '-' else remark end as remark,
							isnull(wgtval, '1') as wgtval,
							isnull(step_code_id,'-') as step_code_id,
							'IFR,REVIEW,IFC' as work_step,
							isnull(step_per,'-') as step_per,
							case when plan_date >= #{cut_off_date} then '1' else '0' end as plan_cnt,
							case when fore_date != '' then '1' else '0' end as fore_cnt,
							case when actual_date >= #{cut_off_date} then '1' else '0' end as actual_cnt,
							isnull(wbs_desc,'-') as wbs_desc,
							count(*) as checkCnt
						from ( 
							select a.prj_id, a.doc_id, a.doc_no, a.title, a.rev_code_id, a.trans_ref_doc_id, a.rev_id,tr.inout as inout,
					   ( select set_code from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and b.category_cd_id = c1.set_code_id) category
									 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='REVISION NUMBER' and a.rev_code_id = c1.set_code_id) rev_no
								 , b.wbs_code_id, b.discip_code_id
								 , (select ppdi.discip_display from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discipline
								 , (select ppdi.discip_code from p_prj_discipline_info ppdi where ppdi.prj_id=a.prj_id and ppdi.discip_code_id=b.discip_code_id) discip_code
								 , b.folder_id, b.doc_type_id 
										 , (select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.TYPE' and c1.set_code_id = b.doc_type_id) doc_type     
								 , b.designer_id
							 ,(select concat(u.user_kor_nm,' ',ci.code_nm)  
							  from p_users u
								   left outer join p_code_info ci on ci.code_gubun ='JOB' and u.job_tit_cd  = ci.code 
								   where u.user_id = b.designer_id) as deginer      
								 , b.size_code_id
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.SIZE' and c1.set_code_id = b.size_code_id) doc_size
								 , c.step_code_id
										 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step     
										 ,(select c1.set_order  from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) set_order             
								 , c.plan_date, c.fore_date, c.actual_date, c.step_seq
										 , (select c1.wbs_code as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_code
										  , (select c1.wbs_desc as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wbs_desc
										  , (select c1.wgtval as set_desc from p_prj_wbs_code c1 where a.prj_id = c1.prj_id and c1.wbs_code_id = b.wbs_code_id) wgtval
								 , tr.tr_no 
								 , tr.tr_issuepur_code_id
								 , tr.issued_rev_no
								 , tr.issued_send_date
								 , tr.rtn_status_code_id
								 , (select concat(c1.set_code, '_', c1.set_desc) as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='TR RETURN STATUS' and tr.rtn_status_code_id = c1.set_code_id) rtn_status_code
								 ,(select c1.set_code as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='DOC.CATEGORY' and c1.set_code_id = b.category_cd_id) tr_issuepur     
								 , tr.send_date
								 , b.remark 
								 , (select c1.set_val as set_desc from p_prj_code_settings c1 where a.prj_id = c1.prj_id and c1.set_code_type ='ENGINEERING STEP' and c1.set_code_id = c.step_code_id) step_per
							from p_prj_document_index a
								 join p_prj_eng_info b on a.prj_id = b.prj_id and a.doc_id = b.doc_id and a.rev_id = b.rev_id 
								 left outer join p_prj_eng_step c on a.prj_id = c.prj_id and a.doc_id = c.doc_id and a.rev_id =  c.rev_id  
								 ,(select prj_id, doc_id, max(rev_id) as rev_id from p_prj_document_index
							where 1=1 
							and del_yn!='Y'
							group by prj_id, doc_id)a1
							,(select tf.prj_id, tf.doc_id, tf.rev_id, tr.tr_no , tf.issue_step, tr.tr_issuepur_code_id,tr.send_date,tr.send_date as issued_send_date, tf.rev_no  as issued_rev_no, tf.rtn_status_code_id, inout 
							  from p_prj_tr_file tf
							  join p_prj_tr_info tr on tf.prj_id  = #{prj_id} and tf.prj_id = tr.prj_id 
													   and tf.tr_id = tr.tr_id and tr.inout='OUT') tr      
							where a.prj_id = #{prj_id}
							and a.prj_id = a1.prj_id 
							and a.doc_id  = a1.doc_id 
							and a.rev_id  = a1.rev_id 
							and a.prj_id = tr.prj_id 
							and a.doc_id = tr.doc_id 
							and a.rev_id = tr.rev_id 
						) aa
						where wbs_code=#{wbs_code}
						and step in ( 'IFC', 'IFR', 'REVIEW' )
						group by discipline,doc_no,rev_no,title,tr_issuepur,wbs_code,doc_type,category,discip_code,plan_date,actual_date,doc_size,deginer,tr_no,send_date,remark,issued_rev_no,issued_send_date,rtn_status_code_id,rtn_status_code,wgtval,step_code_id,step,step_per,fore_date, wbs_desc
	</select>
</mapper>