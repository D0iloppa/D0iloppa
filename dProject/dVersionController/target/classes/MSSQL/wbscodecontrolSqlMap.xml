<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wbscodecontrolSqlMap">
	
	<select id="getWbscodeListAll" resultType="WbsCodeControlVO" parameterType="WbsCodeControlVO">
		SELECT A.* , B.discip_display, B.discip_code_id
		FROM p_prj_wbs_code A LEFT OUTER JOIN p_prj_discipline_info B ON (A.prj_id = B.prj_id and A.discipline = B.discip_code_id)
		WHERE A.prj_id = #{prj_id}
	</select>
	
	<select id="getWbscodeList" resultType="WbsCodeControlVO" parameterType="WbsCodeControlVO">
		SELECT A.* , B.discip_display, B.discip_code_id
		FROM p_prj_wbs_code A LEFT OUTER JOIN p_prj_discipline_info B ON (A.prj_id = B.prj_id and A.discipline = B.discip_code_id)
		WHERE A.prj_id = #{prj_id} and A.doc_type = #{doc_type}
	</select>
	
	<update id="updateWbscodeList" parameterType="WbsCodeControlVO">
		update p_prj_wbs_code
		set wbs_code = #{wbs_code}, wbs_desc = #{wbs_desc}, wgtval = #{wgtval}, doc_type = #{doc_type}
		where prj_id = #{prj_id} AND wbs_code_id = #{wbs_code_id}
	</update>
	
	<delete id="deleteWbscodeList" parameterType="WbsCodeControlVO">
		DELETE FROM p_prj_wbs_code
		WHERE prj_id = #{prj_id} AND wbs_code_id = ${wbs_code_id}
	</delete>
	
	<select id="searchWbscodeList" resultType="WbsCodeControlVO" parameterType="WbsCodeControlVO">
		select * from p_prj_wbs_code AS a LEFT OUTER JOIN p_prj_discipline_info AS b
		on a.wbs_code_id = b.discip_code_id
		<if test="searchChkbox != ''">
			where doc_type = #{searchChkbox}
		</if>
	</select>
	
	<select id="getDiscipFolder" resultType="Long" parameterType="WbsCodeControlVO">
		SELECT discip_folder_id as folder_id
		FROM p_prj_discipline_folder_info
		WHERE prj_id = #{prj_id} AND discip_code_id = #{discipline}
	</select>
	
	<select id="getWBSMaxId" resultType="long" parameterType="WbsCodeControlVO">
		SELECT isnull(MAX(wbs_code_id),0) + 1 
		FROM p_prj_wbs_code
		WHERE prj_id = #{prj_id}
	</select>
	
	<select id="checkFolder" resultType="Integer" parameterType="PrjDisciplineVO">
		SELECT count(*) as cnt
		FROM p_prj_document_index A LEFT OUTER JOIN p_prj_folder_info B ON A.prj_id = B.prj_id AND A.folder_id = B.folder_id
		WHERE A.prj_id = #{prj_id} AND ( B.folder_path like #{folder_name} OR B.folder_id = #{folder_id} )
	</select>
	
	<update id="updateWBS" parameterType="WbsCodeControlVO">
		UPDATE p_prj_wbs_code
		SET wbs_code = #{wbs_code}, wbs_desc = #{wbs_desc}, wgtval = #{wgtval}, doc_type = #{doc_type}, discipline = #{discipline}
		WHERE prj_id = #{prj_id} AND wbs_code_id = #{wbs_code_id}
	</update>
	
	<insert id="insertWBS" parameterType="WbsCodeControlVO">
		INSERT INTO p_prj_wbs_code ( prj_id, wbs_code_id , wbs_code , wbs_desc , wgtval , doc_type , discipline )
		VALUES( #{prj_id}, #{wbs_code_id} , #{wbs_code} , #{wbs_desc} , #{wgtval} , #{doc_type} , #{discipline} )
	</insert>
	
</mapper>