<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="processinfoSqlMap">
    <select id="getProcessTypeByFolderPath" resultType="ProcessInfoVO" parameterType="ProcessInfoVO">
		select dbo.fn_getFolderNm(a.prj_id, a.folder_id) as folder_path_nm,a.folder_path,b.process_type,b.process_folder_path_id, b.doc_type
		from p_prj_folder_info a,
		(SELECT prj_id,class_lvl,process_type,doc_type,value as process_folder_path_id
		FROM p_prj_process_info
		CROSS APPLY STRING_SPLIT(process_folder_path_id, '@')
		WHERE prj_id = #{prj_id})b
		WHERE a.prj_id = #{prj_id} and a.folder_id=b.process_folder_path_id
		ORDER BY folder_path
    </select>
    <select id="getINOUTMatchingFolderId" resultType="ProcessInfoVO" parameterType="ProcessInfoVO">
		select process_folder_path_id from p_prj_process_info where prj_id=#{prj_id} and class_lvl='SYSTEM' and process_type like 'TR OUTGOING%'
    </select>
    <select id="getDRNUseYNByDocType" resultType="ProcessInfoVO" parameterType="ProcessInfoVO">
		select drn_use_yn from p_prj_process_info where prj_id=#{prj_id} and class_lvl='MANUAL' and doc_type=#{doc_type}
	</select>
    <select id="getFolderIsSYSTEMClass" resultType="ProcessInfoVO" parameterType="ProcessInfoVO">
		select * from p_prj_process_info where prj_id=#{prj_id} and class_lvl='SYSTEM' and process_folder_path_id=#{process_folder_path_id}
	</select>
    <select id="getSYSTEMProcessFolderId" resultType="ProcessInfoVO" parameterType="ProcessInfoVO">
		select process_folder_path_id from p_prj_process_info where prj_id=#{prj_id} and class_lvl='SYSTEM' and process_type=#{process_type}
	</select>
    <select id="isCheckUseFolderId" resultType="int" parameterType="ProcessInfoVO">
		select sum(main.cnt) cnt
		FROM
		(
			select count(*) cnt
			from
			(
				select  a.*, b.folder_path
				from
				   	 p_prj_process_info a
				   	 join p_prj_folder_info  b on a.prj_id = b.prj_id and a.process_folder_path_id = b.folder_id
				where a.prj_id = #{prj_id}
			)main
			where main.folder_path LIKE CONCAT('%>',#{process_folder_path_id},'>%') or main.folder_path LIKE CONCAT('%>',#{process_folder_path_id})
			union all
			select count(*) cnt
			from
			(
				select  a.*, b.folder_path
				from
				   	 p_prj_discipline_folder_info a
				   	 join p_prj_folder_info  b on a.prj_id = b.prj_id and a.discip_folder_id = b.folder_id
				where a.prj_id = #{prj_id}
			)main
			where main.folder_path LIKE CONCAT('%>',#{process_folder_path_id},'>%') or main.folder_path LIKE CONCAT('%>',#{process_folder_path_id})
		) main
	</select>
</mapper>